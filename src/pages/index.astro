---
import MinimalList from '@/components/MinimalList'
import BaseLayout from '@/layouts/BaseLayout'
import { getPosts, getApps, getPopularTags, getCategories } from '@/utils'
import IntroBox from '@/components/IntroBox'
import Tag from '@/components/Tag'
import StatsHighlight from '@/components/StatsHighlight'
import Separator from '@/components/Separator'

const MAX_PULSE_POSTS = 5
const MAX_APPS_ITEMS = 5
const MAX_TAGS = 15

// Get latest Pulse posts (excluding Labs and Music)
const pulsePosts = await getPosts(
	MAX_PULSE_POSTS,
	(post) => post.data.category !== 'Music' && post.data.category !== 'Labs'
)

// Get Apps and Labs projects (apps first, then labs)
const apps = await getApps()
const labProjects = await getPosts(undefined, (post) => post.data.category === 'Labs')
const appsAndMore = [...apps, ...labProjects].slice(0, MAX_APPS_ITEMS)

// Get popular tags for tag cloud
const tagCloud = await getPopularTags(MAX_TAGS)

// Calculate stats
const allPosts = await getPosts()
const categories = await getCategories()
const stats = [
	{ label: 'Apps & Labs', value: apps.length + labProjects.length, href: '/apps' },
	{ label: 'Articles', value: allPosts.length, href: '/archive' },
	{ label: 'Categories', value: categories.length, href: '/pulse' },
	{ label: 'Topics', value: tagCloud.length, href: '/tags' }
]
---

<BaseLayout title='JDonado Home'>
	<IntroBox />

	<Separator />

	<!-- Stats Highlight Section -->
	<section class='mt-8'>
		<StatsHighlight stats={stats} />
	</section>

	<Separator />

	<!-- Latest from Pulse Section -->
	<section class='mt-32'>
		<h2 class='text-center md:text-left text-3xl md:text-5xl font-light mb-6'>
			<a href='/pulse' aria-label='View all pulse posts'> Latest from Pulse </a>
		</h2>
		<MinimalList items={pulsePosts} />
	</section>

	<!-- Featured Apps & More Section -->
	<section class='mt-32'>
		<h2 class='text-center md:text-right text-3xl md:text-5xl font-light mb-6'>
			<a href='/apps' aria-label='View all apps and labs'>Recent Apps &amp; Labs</a>
		</h2>
		<MinimalList items={appsAndMore} variant='right-aligned' />
	</section>

	<!-- Tag Cloud Section -->
	{
		tagCloud.length > 0 && (
			<section class='mt-32 mb-16'>
				<div class='flex flex-wrap gap-x-4 gap-y-2 justify-center'>
					{tagCloud.map((tag) => (
						<a
							href={`/tags/${encodeURIComponent(tag.toLowerCase())}`}
							class='text-gray-600 dark:text-gray-400 hover:text-stone-950 dark:hover:text-white transition-colors text-lg m-2'
							aria-label={tag}
						>
							#{tag}
						</a>
					))}
				</div>
			</section>
		)
	}
</BaseLayout>
